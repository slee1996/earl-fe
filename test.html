<div class="w-layout-hflex flex-block-11" id="parentDiv"></div>
<script>
  function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 3958.8; // Radius of the Earth in miles
    const toRadians = (degrees) => (degrees * Math.PI) / 180;

    const dLat = toRadians(lat2 - lat1);
    const dLon = toRadians(lon2 - lon1);

    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(toRadians(lat1)) *
        Math.cos(toRadians(lat2)) *
        Math.sin(dLon / 2) *
        Math.sin(dLon / 2);

    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    const distance = R * c;
    return Math.round(distance * 10) / 10;
  }

  const parentDiv = document.getElementById("parentDiv");

  // Function to create a restaurant div
  const createRestaurantDiv = (restaurant, index, distance) => {
    const newParaDivId = `newParaDiv-${index}`;

    const newDiv = document.createElement("div");
    const newHeading = document.createElement("h4");
    const newHeading2 = document.createElement("h5");
    const newImage = document.createElement("img");
    const newParaDiv = document.createElement("div");

    newParaDiv.setAttribute("id", newParaDivId);
    newDiv.setAttribute(
      "class",
      "w-layout-blockcontainer container-15 w-container"
    );
    newImage.src = restaurant.imageUrl;
    newHeading.innerText = `${restaurant.name}, ${restaurant.city}`;
    newHeading2.innerText = `${distance} miles`;

    newDiv.append(newHeading, newHeading2, newImage, newParaDiv);

    restaurant.description.forEach((description) => {
      const newPara = document.createElement("p");
      newPara.setAttribute("class", "new-paragraph");
      newPara.innerText = description;
      newParaDiv.append(newPara);
    });

    return newDiv;
  };

  // Calculate distances and sort restaurants
  const sortedRestaurants = letsEat
    .map((restaurant) => {
      const distance = haversineDistance(
        heberProperty.address.lat,
        heberProperty.address.lng,
        restaurant.latAndLong[0],
        restaurant.latAndLong[1]
      );
      return { ...restaurant, distance };
    })
    .sort((a, b) => a.distance - b.distance);

  // Create and append restaurant divs
  sortedRestaurants.forEach((restaurant, i) => {
    const restaurantDiv = createRestaurantDiv(
      restaurant,
      i,
      restaurant.distance
    );
    parentDiv.append(restaurantDiv);
  });
</script>
